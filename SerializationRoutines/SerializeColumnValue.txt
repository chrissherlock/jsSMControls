public static void SerialiseColumnValue(IQueryResultColumn Column, IQueryResults Results, BinaryWriter OutputWriter, ITraceStream TraceStream, int ColumnIndex)
{
    object objectValue = RuntimeHelpers.GetObjectValue(Results[ColumnIndex]);
    if (Comparisons.IsNothingOrIsNotDefined(RuntimeHelpers.GetObjectValue(objectValue), false))
    {
        OutputWriter.Write(-1);
    }
    else
    {
        switch (Column.Type)
        {
            case QueryResultDataType.TypeInt16:
            {
                short @short = Conversions.GetShort(RuntimeHelpers.GetObjectValue(objectValue));
                OutputWriter.Write(2);
                OutputWriter.Write(@short);
                return;
            }
            case QueryResultDataType.TypeInt32:
            {
                int integer = Conversions.GetInteger(RuntimeHelpers.GetObjectValue(objectValue));
                OutputWriter.Write(4);
                OutputWriter.Write(integer);
                return;
            }
            case QueryResultDataType.TypeInt64:
            {
                long @long = Conversions.GetLong(RuntimeHelpers.GetObjectValue(objectValue));
                OutputWriter.Write(8);
                OutputWriter.Write(@long);
                return;
            }
            case QueryResultDataType.TypeDouble:
            {
                double num2 = Conversions.GetDouble(RuntimeHelpers.GetObjectValue(objectValue));
                OutputWriter.Write(8);
                OutputWriter.Write(num2);
                return;
            }
            case QueryResultDataType.TypeString:
            {
                byte[] bytes = Encoding.UTF8.GetBytes(Conversions.GetString(RuntimeHelpers.GetObjectValue(objectValue)));
                OutputWriter.Write(bytes.Length);
                if (bytes.Length > 0)
                {
                    OutputWriter.Write(bytes);
                }
                return;
            }
            case QueryResultDataType.TypeDateTime:
            {
                double num = Conversions.GetDate(RuntimeHelpers.GetObjectValue(objectValue)).ToOADate();
                OutputWriter.Write(8);
                OutputWriter.Write(num);
                return;
            }
            case QueryResultDataType.TypeBoolean:
            {
                bool @bool = Conversions.GetBool(RuntimeHelpers.GetObjectValue(objectValue));
                OutputWriter.Write(1);
                OutputWriter.Write(Convert.ToByte(@bool));
                return;
            }
            case QueryResultDataType.TypeBinary:
            {
                byte[] buffer = Conversions.GetBytes(RuntimeHelpers.GetObjectValue(objectValue));
                OutputWriter.Write(buffer.Length);
                if (buffer.Length > 0)
                {
                    OutputWriter.Write(buffer);
                }
                return;
            }
        }
        throw new InfraException("Unknown type", string.Format("{0} is an unknown type", Column.Type.ToString()), new string[] { "Column Name", Column.Name, "Column Type", Column.Type.ToString(), "Column Title", Column.DisplayAs });
    }
}

 

 
